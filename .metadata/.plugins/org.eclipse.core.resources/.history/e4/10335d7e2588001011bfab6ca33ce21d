package main;

// -XX:+PrintCompilation 
// OSR - On-Stack Replacement
/**
 * java -XX:+PrintCompilation main.JITForceDemo
 * 
 * Output:
 * <timestamp> <compilation_id> <attributes> <compilation level(0 and 4)> <methodname> <bytecode size> <deoptimization indicator> 
 * 
 * Attributes : 5 character
 * % - OSR
 * s - synchronizeed method
 * ! - method has exception handler
 * b - compilation occured in blocking mode
 * n - compilation occurred for a wrapper to a native method
 * 
 * Compilation Level
 * tiered compilation  :
 * C1 (client compiler) - fast , less optimized
 * C2 (server compiler) heavier optimizations 
 * 
 * java -XX:-TieredCompilation (disabling): 10000
 * -XX:CompileThreshold=1000 
 * 
 * Deoptimization indicator:
 * 
 * 1. made not entrant : Standard C1 deoptimization  / compilers assumptions proved wrong
 * 2. made zombie : cleanup mechanism for GC to free space from code cache
 */

public class JITForceDemo {
    public static void main(String[] args) {
        long result = 0;
        for (int i = 0; i < 5_000; i++) {   // outer loop
            result += heavyWork();
        }
        System.out.println("Result = " + result);
    }

    static long heavyWork() {
        long sum = 0;
        for (int i = 0; i < 10_000_000; i++) {
            sum += i % 10;
        }
        return sum;
    }
}

